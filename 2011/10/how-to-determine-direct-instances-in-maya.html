<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=author content><title>How to determine direct instances in Maya?</title><link href=http://shihchinw.github.io/css/bootstrap.css rel=stylesheet><link href=http://shihchinw.github.io/css/clean-blog.css rel=stylesheet><link href=//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css rel=stylesheet type=text/css><link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel=stylesheet type=text/css><link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel=stylesheet type=text/css><link href='//fonts.googleapis.com/css?family=Lato:400,400italic|Open+Sans:400italic,600italic,400,600|Coda:800)' media=screen rel=stylesheet type=text/css><script src=https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js></script>
<link rel=stylesheet href=http://shihchinw.github.io/css/prettyprint.css><link rel=stylesheet href=http://shihchinw.github.io/css/lightbox.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css integrity=sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0 crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js integrity=sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4 crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body)})</script><link rel=stylesheet type=text/css href=http://shihchinw.github.io/css/foundation.css><link rel=stylesheet type=text/css href=http://shihchinw.github.io/css/twentytwenty.css><link rel=stylesheet type=text/css href=http://shihchinw.github.io/css/header-anchor.css><link rel="shortcut icon" type=image/png href=http://shihchinw.github.io/favicon.png><style>.katex{font-size:1.1em!important}.intro-header .overlay{background:rgba(0,0,0,.47);z-index:1;width:100%;height:100%;top:0}p+ul{margin-top:-24px}p+ol{margin-top:-24px}h1+p,h2+p,h3+p{margin-top:15px}.summary-content{text-align:justify;margin:5px 0}a.read-more-link{color:#f44336;font-weight:bolder;margin-left:5px}code>div>.table{margin-bottom:0;padding:0}code>div>.table>tbody>tr>td{border-top:none;padding:0}.container .img-responsive{padding:5px;margin:auto;-moz-box-shadow:0 0 5px rgba(0,0,0,.15);-webkit-box-shadow:0 0 5px rgba(0,0,0,.15);box-shadow:0 0 5px rgba(0,0,0,.15);-moz-border-radius:5px;-webkit-border-radius:5px;border-radius:5px;margin-top:10px;margin-bottom:10px}.twentytwenty-container .img-responsive{padding:0;margin:0 auto;-moz-box-shadow:none;-webkit-box-shadow:none;box-shadow:none;border-radius:0}.figure .img-responsive{padding:0;margin:auto;-moz-box-shadow:none;-webkit-box-shadow:none;box-shadow:none;border-radius:0;margin-top:0;margin-bottom:5px}.figure{padding:5px;margin:auto;-moz-box-shadow:0 0 10px rgba(0,0,0,.2);-webkit-box-shadow:0 0 10px rgba(0,0,0,.2);box-shadow:0 0 10px rgba(0,0,0,.2);-moz-border-radius:5px;-webkit-border-radius:5px;border-radius:5px;margin-top:15px;margin-bottom:15px;display:table}figure figcaption{text-align:center;font-size:14px;color:gray}.container li a{text-decoration:underline}.container a:hover,a:focus{background:#a6dcf3;text-decoration:none}samp{display:block;background-color:#003700;font-size:.8em;text-align:left;color:#0f0;padding:5px;white-space:pre-wrap;border-radius:5px;margin:10px 0}samp.error{color:red}blockquote p:first-child,blockquote ul:first-child,blockquote ol:first-child{margin-top:0}.container blockquote{background:#fff1e5;padding:8px;margin-top:20px;margin-bottom:20px;text-align:justify;line-height:1.5;border:dashed;border-color:#e4c9c4}.container blockquote.feedback{white-space:pre-wrap}blockquote time{font-size:80%}blockquote{color:#806565}blockquote a{color:#337ab7}span.blue{border-bottom:1px solid #a6dcf3;box-shadow:inset 0 -6px #a6dcf3}span.orange{border-bottom:1px solid #ffd18c;box-shadow:inset 0 -6px #ffd699}span.red{color:#dc1111}span.green{border-bottom:1px solid #cdf9bb;box-shadow:inset 0 -6px #cdf9bb}.tag-box{list-style:none;margin:0;padding:4px 0;overflow:hidden}.tag-box.inline li{float:left}.tag-box li{padding:4px 6px;margin:2px;background-color:#e6e6e6;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px}.tag-box li a{text-decoration:none}</style></head><body onload=PR.prettyPrint()><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle data-toggle=collapse data-target=#bs-example-navbar-collapse-1>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button>
<a class=navbar-brand href=http://shihchinw.github.io>Shih-Chin</a></div><div class="collapse navbar-collapse" id=bs-example-navbar-collapse-1><ul class="nav navbar-nav navbar-right"><li><a href=http://shihchinw.github.io/>home</a></li><li><a href=http://shihchinw.github.io/page/computer-graphics.html>Computer Graphics</a></li><li><a href=http://shihchinw.github.io/page/global-illumination.html>Global Illumination</a></li><li><a href=http://shihchinw.github.io/page/arnold.html>Arnold</a></li><li><a href=http://shihchinw.github.io/page/maya.html>Maya</a></li><li><a href=http://shihchinw.github.io/post.html>Posts</a></li><li><a href=http://shihchinw.github.io/about.html>About</a></li></ul></div></div></nav><header class=intro-header><div class=overlay><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>How to determine direct instances in Maya?</h1><h2 class=subheading></h2><span class=meta>Posted by Shih-Chin on Sun, Oct 16, 2011</span></div></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><p>Any instanced node in Maya has multiple parent transforms, therefore, the basic idea to determine the instanced node is to check the number of its parent nodes. However, if we have <span class=blue><em>both instanced shapes and some other transform nodes from the same hierarchy</em></span>, it gets a little harder to handle this situation just by MEL.</p><p>Let&rsquo;s consider the following case:</p><ol><li>Create an instance of pCube1 as pCube2.</li><li>Group them into group1.</li><li>Create another instance group2 from group1.</li></ol><p><img src=http://shihchinw.github.io/images/maya/maya_instanced_case.jpg alt="Maya instances"></p><p>Okay, now our goal is to find out the direct instances (indicated by the dash lines). How could we achieve this purpose with Maya API?</p><h1 id=mitdagisinstancedindirectspan-classbluefalsespan>MItDag.isInstanced(indirect=<span class=blue>False</span>)</h1><p>We all don&rsquo;t wanna parse the strings of all dag paths to figure out these direct instances, don&rsquo;t we? Fortunately, <code>MItDag.isInstanced</code> is what we need! But there is one thing should be aware of: <span class=orange>isInstanced() returns true for not only the spawned instances but also the original ones (i.e. group1|pCube1|pCubeShape1).</span></p><p>In order to distinguish the original from these nodes qualified by isInstanced(), we need to examine the identifications of their parent transforms further.</p><pre class="prettyprint linenums lang-python">
import maya.OpenMaya as om
dagIter = om.MItDag(om.MItDag.kBreadthFirst)
dagPath = om.MDagPath()
fnDagNode = om.MFnDagNode()

detectIndirect = False

while not dagIter.isDone():
    if dagIter.isInstanced(detectIndirect):

        dagIter.getPath(dagPath)
        dagPath.pop(1)

        fnDagNode.setObject(dagIter.currentItem())

        if fnDagNode.parent(0) != dagPath.node():
            print dagIter.fullPathName()

    dagIter.next()
</pre><p>Here is the result:
<samp>|group2|pCube1
|group2|pCube2
|group1|pCube2|pCubeShape1
|group2|pCube2|pCubeShape1</samp></p><p><span class=red><strong>Note:</strong></span> <em>&ldquo;dagPath.instanceNumber() != 0&rdquo;</em> is not a sufficient condition for <code>line#16</code>, since it can&rsquo;t filter out &ldquo;group2|pCube1|pCubeShape1&rdquo;!</p><h1 id=reference>Reference</h1><ul><li><cite><a href=http://ewertb.soundlinker.com/mel/mel.085.htm>How do I determine if a shape node has been instanced?</a></cite> by Bryan Ewert.</li></ul><hr><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//shihchinw.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div></article><hr><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a href=mailto:shihchin.weng@gmail.com><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i>
<i class="fa fa-envelope-o fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://twitter.com/shihchinw><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i>
<i class="fa fa-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://github.com/shihchinw><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i>
<i class="fa fa-github fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright © Shih-Chin</p></div></div></div></footer><script src=http://shihchinw.github.io/js/jquery.min.js></script>
<script src=http://shihchinw.github.io/js/bootstrap.min.js></script>
<script src=http://shihchinw.github.io/js/clean-blog.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-336629647"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-336629647",{anonymize_ip:!1})}</script><script src=http://shihchinw.github.io/js/lightbox.js></script>
<script src=http://shihchinw.github.io/js/jquery.event.move.js></script>
<script src=http://shihchinw.github.io/js/jquery.twentytwenty.js></script>
<script>$(window).load(function(){$(".twentytwenty-container[data-orientation!='vertical']").twentytwenty({default_offset_pct:.7}),$(".twentytwenty-container[data-orientation='vertical']").twentytwenty({default_offset_pct:.3,orientation:"vertical"})}),$(function(){return $("h1, h2, h3, h4, h5, h6").each(function(e,t){var n=$(t),s=n.attr("id"),o='<i class="fa fa-link"></i>';if(s)return n.append($("<a />").addClass("header-link").attr("href","#"+s).html(o))})})</script></body></html>