<!DOCTYPE html>
<html lang="en-us">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Aperture &amp; f-number</title>

    

    
    <link href="http://shihchinw.github.io/css/bootstrap.css" rel="stylesheet">

    
    <link href="http://shihchinw.github.io/css/clean-blog.css" rel="stylesheet">

    
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Lato:400,400italic|Open+Sans:400italic,600italic,400,600|Coda:800)' media='screen' rel='stylesheet' type='text/css'/>

    
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
    <link rel="stylesheet" href="http://shihchinw.github.io/css/prettyprint.css">
    

    <link rel="stylesheet" href="http://shihchinw.github.io/css/lightbox.css">

    
    
    

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.css" integrity="sha384-D+9gmBxUQogRLqvARvNLmA9hS2x//eK1FhVb9PiU86gmcrBrJAQT8okdJ4LMp2uv" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.js" integrity="sha384-483A6DwYfKeDa0Q52fJmxFXkcPCFfnXMoXblOkJ4JcA8zATN6Tm78UNL72AKk+0O" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/contrib/auto-render.min.js" integrity="sha384-yACMu8JWxKzSp/C1YV86pzGiQ/l1YUfE8oPuahJQxzehAjEt2GiQuy/BIvl9KyeF" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
          renderMathInElement(document.body);
        });
    </script>

    <link rel="stylesheet" type="text/css" href="http://shihchinw.github.io/css/foundation.css">
    <link rel="stylesheet" type="text/css" href="http://shihchinw.github.io/css/twentytwenty.css">
    <link rel="stylesheet" type="text/css" href="http://shihchinw.github.io/css/header-anchor.css">
    <link rel="shortcut icon" type="image/png" href="http://shihchinw.github.io/favicon.png">

    <style>
    .katex { font-size: 1.1em !important; }

    .intro-header .overlay {
        background: rgba(0, 0, 0, 0.47);
        z-index: 1;
        width: 100%;
        height: 100%;
        top: 0;
    }

    p + ul { margin-top: -24px; }
    p + ol { margin-top: -24px; }
    h1 + p, h2 + p, h3 + p { margin-top: 15px; }

    .summary-content {
        text-align: justify;
        margin: 5px 0px 5px 0px;
    }

    a.read-more-link {
        color: #f44336;
        font-weight: bolder;
        margin-left: 5px;
    }

    code > div > .table {
        margin-bottom: 0px;
        padding: 0px;
    }

    code > div > .table > tbody > tr > td {
        border-top: none;
        padding: 0px;
    }

    .container .img-responsive {
        padding: 5px;
        margin: auto;
        -moz-box-shadow: 0 0 5px rgba(0, 0, 0, .15);
        -webkit-box-shadow: 0 0 5px rgba(0, 0, 0, .15);
        box-shadow: 0 0 5px rgba(0, 0, 0, .15);
        -moz-border-radius: 5px;
        -webkit-border-radius: 5px;
        border-radius: 5px;
        margin-top: 10px;
        margin-bottom: 10px;
    }

    .twentytwenty-container .img-responsive {
        padding: 0px;
        margin: 0px auto;
        -moz-box-shadow: none;
        -webkit-box-shadow: none;
        box-shadow: none;
        border-radius: 0px;
    }

    .figure .img-responsive {
        padding: 0px;
        margin: auto;
        -moz-box-shadow: none;
        -webkit-box-shadow: none;
        box-shadow: none;
        border-radius: 0px;
        margin-top: 0px;
        margin-bottom: 5px;
    }

    .figure {
        padding: 5px;
        margin: auto;
        -moz-box-shadow: 0 0 10px rgba(0, 0, 0, .2);
        -webkit-box-shadow: 0 0 10px rgba(0, 0, 0, .2);
        box-shadow: 0 0 10px rgba(0, 0, 0, .2);
        -moz-border-radius: 5px;
        -webkit-border-radius: 5px;
        border-radius: 5px;
        margin-top: 15px;
        margin-bottom: 15px;
        display: table;
    }

    figure figcaption {
         
        text-align: center;
        font-size: 14px;
         
        color: #808080;
    }

    .container li a {
        text-decoration: underline;
    }

    .container a:hover, a:focus {
         
        background: #A6DCF3;
        text-decoration: none;
    }

    samp {
        display: block;
        background-color: rgba(0, 55, 0, 1);
        font-size: 0.8em;
        text-align: left;
        color: rgba(0, 255, 0, 1);
        padding: 5px;
        white-space: pre-wrap;
        border-radius: 5px;
        margin: 10px 0px;
    }

    samp.error {
        color: red;
    }

    blockquote p:first-child, blockquote ul:first-child, blockquote ol:first-child {
        margin-top: 0;
    }

    .container blockquote {
         
        background: #FFF1E5;
        padding: 8px;
        margin-top: 20px;
        margin-bottom: 20px;
         
        text-align: justify;
        line-height: 1.5;
        border: dashed;
        border-color: rgb(228, 201, 196);
    }

    .container blockquote.feedback {
        white-space: pre-wrap;
    }

    blockquote time {
        font-size: 80%;
    }

    blockquote {
        color: #806565;
    }

    blockquote a {
        color: #337ab7;
    }

    span.blue {
        border-bottom: 1px solid #a6dcf3;
        box-shadow: inset 0 -6px 0 #a6dcf3;
    }
    span.orange {
        border-bottom: 1px solid #ffc672;
        box-shadow: inset 0 -6px 0 #ffc672;
    }
    span.red { color: #dc1111; }
    span.green {
        border-bottom: 1px solid #cdf9bb;
        box-shadow: inset 0 -6px 0 #cdf9bb;
    }

    .tag-box {
        list-style: none;
        margin: 0;
        padding: 4px 0;
        overflow: hidden;
    }
    .tag-box.inline li {
        float: left;
    }
    .tag-box li {
        padding: 4px 6px;
        margin: 2px;
        background-color: #e6e6e6;
        -webkit-border-radius: 4px;
        -moz-border-radius: 4px;
        border-radius: 4px;
    }
    .tag-box li a {
        text-decoration: none;
    }
    </style>

</head>

<body onload="PR.prettyPrint()">

    
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="http://shihchinw.github.io">Shih-Chin</a>
            </div>
            
<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="nav navbar-nav navbar-right">
        
        <li>
            <a href="http://shihchinw.github.io/">home</a>
        </li>
        
        <li>
            <a href="http://shihchinw.github.io/page/computer-graphics.html">Computer Graphics</a>
        </li>
        
        <li>
            <a href="http://shihchinw.github.io/page/global-illumination.html">Global Illumination</a>
        </li>
        
        <li>
            <a href="http://shihchinw.github.io/page/arnold.html">Arnold</a>
        </li>
        
        <li>
            <a href="http://shihchinw.github.io/page/maya.html">Maya</a>
        </li>
        
        <li>
            <a href="http://shihchinw.github.io/post.html">Posts</a>
        </li>
        
        <li>
            <a href="http://shihchinw.github.io/about/">About</a>
        </li>
        
      </ul>
</div>


        </div>
        
    </nav>


    
    
    <header class="intro-header">
    
      <div class="overlay">
        <div class="container">
          <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
              <div class="post-heading">
                <h1>Aperture &amp; f-number</h1>
                <h2 class="subheading"></h2>
                <span class="meta">
                 
Posted by Shih-Chin on Fri, Aug 10, 2018


               </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    
    <article>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                  <p>I have been using DSLR for over 10 years, I thought I knew few knowledge about photography. But after I watched a wonderful online course of digital photography by Prof. Marc Levoy [<a href="#ref.1">1</a>], I just found there were so many details I weren&rsquo;t aware before. The thing embarrassed me the most was that I incorrectly related f-number to lens aperture size. This post is trying to introduce the idea of f-number starting from scene radiance.</p>

<p></p>

<h1 id="radiance-invariance">Radiance Invariance</h1>

<p>Radiance [<a href="#ref.5">5</a>] is a very important quantity in light transport. It is the radiant flux emitted, reflected, transmitted or received by a given surface, per unit projected area per unit solid angle. In other words, it measures the density of photons passing <em>near a position \(\mathbf{x}\) and travelling in directions in \(\omega\)</em>:</p>

<p>$$L(\mathbf{x}, \omega) = \frac{d^2 \Phi}{d\omega dA \cos{\theta}}$$</p>

<p><span class="blue">Radiance is <strong>invariant</strong> as it propagates along a line in empty space.</span> That is, for two patches x, y in empty space, the radiance measured from x to y is identical to the one from y to x. This could be derived from the conservation of flux</p>

<p><img src="http://shihchinw.github.io/images/rendering/radiance_invariance_1.png" style="box-shadow: none;" alt="radiance invariance of two stationary patches"/></p>

<p>The radiance from y to x is</p>

<p>$$L_{y\rightarrow x} = \frac{d^2 \Phi}{\textcolor{#1eb8c1}{d\omega_y} dA_x \cos{\theta_x}} = \frac{\textcolor{#1eb8c1}{r^2}d^2 \Phi}{\textcolor{#1eb8c1}{dA_y\cos{\theta_y}} dA_x \cos{\theta_x}}$$</p>

<p>where \(d\omega_y = \frac{dA_y \cos{\theta_y}}{r^2}\). Likewise, the radiance from x to y is</p>

<p>$$L_{x\rightarrow y} = \frac{d^2 \Phi}{d\omega_x dA_y \cos{\theta_y}} = \frac{r^2 d^2 \Phi}{dA_x \cos{\theta_x} dA_y \cos{\theta_y}} = L_{y\rightarrow x}$$</p>

<p>This shows that the radiance interchanged between two patches is the same. But when the patch y goes farther at the distance \(r^\prime\) away from x, the solid angle \(d\omega_y^\prime\) would become \(\frac{r^2}{r^{\prime2}} d\omega_y\)</p>

<p><img src="http://shihchinw.github.io/images/rendering/radiance_invariance_2.png" style="box-shadow: none;" alt="radiance invariance as the distance changes"/></p>

<p>$$L^\prime_{y\rightarrow x} = \frac{d^2 \Phi^\prime}{d\omega^\prime_y dA_x \cos{\theta_x}} = \frac{d^2 \Phi^\prime}{d\omega_y dA_x \cos{\theta_x}} \frac{r^{\prime2}}{r^2}$$</p>

<p>From <strong>the inverse square law</strong> [<a href="#ref.7">7</a>], the density of flux is inversely proportional to the square of the distance in between \(\Phi^\prime = \frac{r^2}{r^{\prime2}} \Phi\), therefore</p>

<p>$$L^\prime_{y\rightarrow x} = \frac{d^2 \textcolor{#1eb8c1}{\Phi^\prime}}{d\omega_y dA_x \cos{\theta_x}} \frac{r^{\prime2}}{r^2} = \frac{d^2  \textcolor{#1eb8c1}{\Phi}}{d\omega_y dA_x \cos{\theta_x}} \cancel{\frac{r^{\prime2}}{r^2}} \cancel{\textcolor{#1eb8c1}{\frac{r^2}{r^{\prime2}}}} = L_{y\rightarrow x}$$</p>

<p>Surprisingly, no matter how far the two patches are apart, the radiance is also <strong>constant</strong> as they moving along the same line. These two cases demonstrate the invariance of radiance.</p>

<h1 id="scene-radiance-to-image-irradiance">Scene Radiance to Image Irradiance</h1>

<p>Now, let&rsquo;s consider a radiance transport from surface patch \(dA_o\) through a thin convex lens whose diameter is \(D\) onto the image patch \(dA_i\).</p>

<p><img src="http://shihchinw.github.io/images/rendering/scene_radiance_to_image_irradiance.png" style="box-shadow: none;" alt="radiance transport"/></p>

<p>Suppose both surface patch and image plane are in the air (i.e. the refractive index is \(\approx 1\)). The irradiance of image patch is \(E_i = L_d\ d\omega_d \cos{\alpha}\), where \(L_d\) is the radiance from lens to \(dA_i\) in directions \(d\omega_d\). Since <span class="blue">all radiances from the patch \(dA_o\) through the thin convex lens would converge on the image patch \(dA_i\)</span>, and with the radiance invariance property, we could associate the radiance from surface patch to image patch \(L_d = L_o\). Therefore</p>

<p>$$E_i = L_d \frac{\pi(\frac{D}{2})^2 \cos{\alpha}}{(\frac{s_i}{\cos{\alpha}})^2} \cos{\alpha} = L_o \frac{\pi}{4} \Big(\frac{D}{s_i}\Big)^2 \cos^4{\alpha}$$</p>

<p>This shows the image irradiance \(E_i\) is in linear proportion to scene radiance \(L_o\), and the factor \(\cos^4{\alpha}\) is the cause of vignette. To relate with lens focal length \(f\), \(s_i\) could be substituted by \(\frac{f s_o}{s_o - f}\) from Gaussian lens formula:</p>

<p>$$\frac{1}{f} = \frac{1}{s_i} + \frac{1}{s_o} \Rightarrow s_i = \frac{f s_o}{s_o - f}$$</p>

<p>Thus the <em>fundamental radiometric relation</em> between the scene radiance \(L_o\) and the irradiance \(E_i\) on image plane is</p>

<p>$$E_i = L_d \frac{\pi}{4} \Big(\frac{(s_o - f)D}{f s_o}\Big)^2 \cos^4{\alpha}$$</p>

<blockquote>
<p>Be careful about the differences whether the focus is at infinity or not. By definition, the focal point is the converge point of <strong>parallel</strong> rays.</p>

<p>If the surface patch and image plane are in different medium, we should take the refractive index of both space into account. For more details, please refer to &ldquo;Fundamental optical formulae&rdquo; by Andy Rowlands [<a href="#ref.2">2</a>].</p>
</blockquote>

<p>Here we could see the image irradiance \(E_i\) changes w.r.t. focal length \(f\). It surprised me a lot, since I haven&rsquo;t noticed the changes of exposure when I changed the focal length of a zoom lens. What&rsquo;s happened underneath?</p>

<h1 id="f-number">f-number</h1>

<p>When focus is set at <em>infinity</em> (i.e. \(s_i \approx f, s_o = \infty\)), the irradiance \(E_i\) on image plane is</p>

<p>$$E_i = L_d \frac{\pi}{4} \Big(\frac{D}{f}\Big)^2 \cos^4{\alpha}$$</p>

<p>To make such relation numerically convenient, <strong>f-number</strong> \(N\) is defined as the ratio of focal length to the diameter of the aperture:</p>

<p>$$N = \frac{f}{D}$$</p>

<p>This means, for f/2.0 (i.e. \(N=2\)) lens, the aperture size is 25mm when the focal length is 50mm; while the aperture size is 50mm as the focal length is changed to 100mm. Additionally, the aperture size is</p>

<p>$$D = \frac{f}{N}$$</p>

<p>If \(f\) is fixed, doubling \(N\) would halve the size of aperture, therefore the exposure would reduce to <sup>1</sup>&frasl;<sub>4</sub> (\(N^\prime = 2N \rightarrow D^\prime = D/2 \rightarrow E^\prime = E/4\)). Likewise, if we want to double the exposure, we have to increase \(N\) by \(\sqrt{2}\). This is why the sequence of \(N\) is</p>

<p>$$1.4, 2, 2.8, 4, 5.6, 8, 11, 16, 22, 32, &hellip;$$</p>

<p>When the focus is not at infinity, the apertal ratio \(\frac{(s_o - f)D}{f s_o}\) is called <strong>working f-number</strong>. <span class="blue">For any fixed f-number, the aperture size would change along with the lens focal length.</span> Therefore, the exposure is nearly constant with camera zoom.</p>

<h1 id="conclusion">Conclusion</h1>

<p>I had accidentally mixed the definitions of aperture and f-number for a long time. The most embarrassing thing is that I&rsquo;ve never noticed the difference of them myself, and spread my incorrect knowledge to people around me. I should study more thoroughly and should not take everything for granted. Always be aware of the knowledge gaps and review fundamental things more often to see if I have misunderstood something.</p>

<p>As always, if there are any mistakes in this post, please let me know. Thanks for your reading.</p>

<h1 id="references">References</h1>

<ol>
<li>Marc Levoy. <cite id="ref.1"><a href="https://sites.google.com/site/marclevoylectures/schedule">Lectures on Digital Photography</a>, 2016.</li>
<li>Andy Rowlands. <cite id="ref.2"><a href="http://iopscience.iop.org/book/978-0-7503-1242-4/chapter/bk978-0-7503-1242-4ch1">Fundamental optical formulae</a>, 2017.</li>
<li>John P. Hess. <a href="https://www.youtube.com/watch?v=CGGUXAMliqM">The Properties of Camera Lenses</a>, Filmmaker IQ.</li>
<li>CS6475. <a href="https://www.udacity.com/course/computational-photography--ud955">Computational Photography</a>, Georgia Tech.</li>
<li>Wikipedia. <cite id="ref.5"><a href="https://en.wikipedia.org/wiki/Radiance">Radiance</a>.</li>
<li>Wikipedia. <a href="https://en.wikipedia.org/wiki/F-number">f-number</a>.</li>
<li>Wikipedia. <cite id="ref.7"><a href="https://en.wikipedia.org/wiki/Inverse-square_law">Inverse square law</a>.</li>
</ol>
                  
    <hr>
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "shihchinw" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


                </div>
            </div>
        </div>
    </article>

    <hr>
    
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                  <ul class="list-inline text-center">
                    
                      <li>
                        <a href="mailto:shihchin.weng@gmail.com">
                          <span class="fa-stack fa-lg">
                            <i class="fa fa-circle fa-stack-2x"></i>
                            <i class="fa fa-envelope-o fa-stack-1x fa-inverse"></i>
                          </span>
                        </a>
                      </li>
                    
                    
                    <li>
                      <a href="https://twitter.com/shihchinw">
                        <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                        </span>
                      </a>
                    </li>
                    
                    <li>
                      <a href="https://github.com/shihchinw">
                        <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                        </span>
                      </a>
                    </li>
                    
                  </ul>
                  <p class="copyright text-muted">Copyright Â© Shih-Chin</p>
                </div>
            </div>
        </div>
    </footer>

    
    <script src="http://shihchinw.github.io/js/jquery.min.js"></script>

    
    <script src="http://shihchinw.github.io/js/bootstrap.min.js"></script>

    
    <script src="http://shihchinw.github.io/js/clean-blog.js"></script>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-71352938-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


    <script src="http://shihchinw.github.io/js/lightbox.js"></script>

    <script src="http://shihchinw.github.io/js/jquery.event.move.js"></script>
    <script src="http://shihchinw.github.io/js/jquery.twentytwenty.js"></script>
    

    <script>
        $(window).load(function(){
          $(".twentytwenty-container[data-orientation!='vertical']").twentytwenty({default_offset_pct: 0.7});
          $(".twentytwenty-container[data-orientation='vertical']").twentytwenty({default_offset_pct: 0.3, orientation: 'vertical'});
        });

        
        $(function() {
          return $("h1, h2, h3, h4, h5, h6").each(function(i, el) {
            var $el, icon, id;
            $el = $(el);
            id = $el.attr('id');
            icon = '<i class="fa fa-link"></i>';
            if (id) {
              return $el.append($("<a />").addClass("header-link").attr("href", "#" + id).html(icon));
            }
          });
        });
    </script>
</body>

</html>

