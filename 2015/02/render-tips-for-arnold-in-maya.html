<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=author content><title>Render Tips for Arnold in Maya</title>
<link href=https://shihchinw.github.io/css/bootstrap.css rel=stylesheet><link href=https://shihchinw.github.io/css/clean-blog.css rel=stylesheet><link href=//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css rel=stylesheet type=text/css><link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel=stylesheet type=text/css><link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel=stylesheet type=text/css><link href='//fonts.googleapis.com/css?family=Lato:400,400italic|Open+Sans:400italic,600italic,400,600|Coda:800)' media=screen rel=stylesheet type=text/css><script src=https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js></script><link rel=stylesheet href=https://shihchinw.github.io/css/prettyprint.css><link rel=stylesheet href=https://shihchinw.github.io/css/lightbox.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css integrity=sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0 crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js integrity=sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body)})</script><link rel=stylesheet type=text/css href=https://shihchinw.github.io/css/foundation.css><link rel=stylesheet type=text/css href=https://shihchinw.github.io/css/twentytwenty.css><link rel=stylesheet type=text/css href=https://shihchinw.github.io/css/header-anchor.css><link rel="shortcut icon" type=image/png href=https://shihchinw.github.io/favicon.png><style>.katex{font-size:1.1em!important}.intro-header .overlay{background:rgba(0,0,0,.47);z-index:1;width:100%;height:100%;top:0}p+ul{margin-top:-24px}p+ol{margin-top:-24px}h1+p,h2+p,h3+p{margin-top:15px}.summary-content{text-align:justify;margin:5px 0}a.read-more-link{color:#f44336;font-weight:bolder;margin-left:5px}code>div>.table{margin-bottom:0;padding:0}code>div>.table>tbody>tr>td{border-top:none;padding:0}.container .img-responsive{padding:5px;margin:auto;-moz-box-shadow:0 0 5px rgba(0,0,0,.15);-webkit-box-shadow:0 0 5px rgba(0,0,0,.15);box-shadow:0 0 5px rgba(0,0,0,.15);-moz-border-radius:5px;-webkit-border-radius:5px;border-radius:5px;margin-top:10px;margin-bottom:10px}.twentytwenty-container .img-responsive{padding:0;margin:0 auto;-moz-box-shadow:none;-webkit-box-shadow:none;box-shadow:none;border-radius:0}.figure .img-responsive{padding:0;margin:auto;-moz-box-shadow:none;-webkit-box-shadow:none;box-shadow:none;border-radius:0;margin-top:0;margin-bottom:5px}.figure{padding:5px;margin:auto;-moz-box-shadow:0 0 10px rgba(0,0,0,.2);-webkit-box-shadow:0 0 10px rgba(0,0,0,.2);box-shadow:0 0 10px rgba(0,0,0,.2);-moz-border-radius:5px;-webkit-border-radius:5px;border-radius:5px;margin-top:15px;margin-bottom:15px;display:table}figure figcaption{text-align:center;font-size:14px;color:gray}.container li a{text-decoration:underline}.container a:hover,a:focus{background:#a6dcf3;text-decoration:none}samp{display:block;background-color:#003700;font-size:.8em;text-align:left;color:#0f0;padding:5px;white-space:pre-wrap;border-radius:5px;margin:10px 0}samp.error{color:red}blockquote p:first-child,blockquote ul:first-child,blockquote ol:first-child{margin-top:0}.container blockquote{background:#fff1e5;padding:8px;margin-top:20px;margin-bottom:20px;text-align:justify;line-height:1.5;border:dashed;border-color:#e4c9c4}.container blockquote.feedback{white-space:pre-wrap}blockquote time{font-size:80%}blockquote{color:#806565}blockquote a{color:#337ab7}span.blue{border-bottom:1px solid #a6dcf3;box-shadow:inset 0 -6px #a6dcf3}span.orange{border-bottom:1px solid #ffd18c;box-shadow:inset 0 -6px #ffd699}span.red{color:#dc1111}span.green{border-bottom:1px solid #cdf9bb;box-shadow:inset 0 -6px #cdf9bb}.tag-box{list-style:none;margin:0;padding:4px 0;overflow:hidden}.tag-box.inline li{float:left}.tag-box li{padding:4px 6px;margin:2px;background-color:#e6e6e6;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px}.tag-box li a{text-decoration:none}</style></head><body onload=PR.prettyPrint()><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle data-toggle=collapse data-target=#bs-example-navbar-collapse-1>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=https://shihchinw.github.io>Shih-Chin</a></div><div class="collapse navbar-collapse" id=bs-example-navbar-collapse-1><ul class="nav navbar-nav navbar-right"><li><a href=https://shihchinw.github.io/>home</a></li><li><a href=https://shihchinw.github.io/page/computer-graphics.html>Computer Graphics</a></li><li><a href=https://shihchinw.github.io/page/global-illumination.html>Global Illumination</a></li><li><a href=https://shihchinw.github.io/page/arnold.html>Arnold</a></li><li><a href=https://shihchinw.github.io/page/maya.html>Maya</a></li><li><a href=https://shihchinw.github.io/post.html>Posts</a></li><li><a href=https://shihchinw.github.io/about.html>About</a></li></ul></div></div></nav><header class=intro-header style=background-image:url(https://shihchinw.github.io/images/arnold/mtoa_tips.png)><div class=overlay><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>Render Tips for Arnold in Maya</h1><h2 class=subheading></h2><span class=meta>Posted by Shih-Chin on Sun, Feb 22, 2015</span></div></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><p>All photo-realistic ray-tracers are trying to solve the <a href=http://www.wired.com/2010/07/st_equation_3danimation/>rendering equation</a>. Although they are all categorized as ray-tracer instead of rasterizer, the infrastructure of each implementations are quite different (i.e. uni-directional vs. bi-directional, pure path tracing vs. works with photon-map or <a href=http://cgg.mff.cuni.cz/~jaroslav/papers/2008-irradiance_caching_class/>irradiance caching</a>, etc).</p><p>Arnold is an <em>un-bias uni-directional path tracer</em> with a remarkable importance sampling mechanism and great memory management to achieve amazing performance excellence. However, if we blindly increase the number of ray samples for every render scene, we would not always get a cleaner imagery. Which means that when we switch from one ray-tracer to another, we had better use different strategies to adjust render settings. Here is the summary about what I&rsquo;ve learned from experience, hope it would help any Arnold user. :)</p><h1 id=general>General</h1><ol><li><span class=orange><strong>Always using tx!</strong></span> It can significantly reduce I/O time!
<img src=https://shihchinw.github.io/images/arnold/mtoa_use_existing_tx.jpg alt=tx></li><li>Change log verbosity to <code>Warnings + Info</code>. This is very useful for render process diagnosis. <img src=https://shihchinw.github.io/images/arnold/mtoa_log_verbosity.jpg alt=mtoa_verbosity></li><li>Configure <a href="http://forums.cgsociety.org/showthread.php?t=1089478">file output</a>
<img src=https://shihchinw.github.io/images/arnold/mtoa_output_setting.jpg alt="mtoa output setting"></li></ol><ul><li>Set compression format to <code>zips</code> and enable <code>half-precision</code>, <code>auto-crop</code> to save storage.</li><li><del>Turn off <code>tiled</code>, since most compositors prefer scanline format.</del> This is only valid before Nuke 7. Reading tiled EXR in Nuke 9 is <span class=orange><a href=http://www.cgchannel.com/2014/10/the-foundry-details-new-features-of-nuke-9-nukex-9/><strong>25 times faster</strong></a></span>. Besides, scanline EXR has <a href=#FDBK1>memory overhead</a> when rendering many AOVs. So let&rsquo;s turn <code>tiled</code> <strong>ON</strong> now!</li></ul><ol start=4><li>Check output log for any missing or broken textures.</li></ol><ul><li>Arnold will stop rendering process immediately when it fails to access target textures.</li></ul><ol start=5><li>Use <code>aiUtility</code> to examine the problems of geometry such as:<ul><li>over-smoothing (tessellation) mesh<ul><li>The number of triangles would affect the render performance since ray tracer needs to load all the objects in the scene before tracing.</li></ul></li><li>face penetration, discontinuous tangent/normal vectors, etc<ul><li>Those problem would cause discontinuous shading artifacts.</li></ul></li></ul></li></ol><h1 id=linear-workflow>Linear Workflow</h1><p>The best practice of photo-realistic rendering should be done with <a href=http://filmicgames.com/archives/299>linear workflow</a>. Maya supports color management after Maya 2015, but few things should be noticed. When we turn on the color management in Maya:
<img src=https://shihchinw.github.io/images/maya/maya_color_management.png alt="Color Management in Maya"></p><p>We need to set all parameters in <code>gamma correction</code> to <strong>1.0</strong> and set display gamma to sRGB, Rec 709, etc:
<img src=https://shihchinw.github.io/images/arnold/mtoa_gamma_correction.png alt="Gamma Correction in Render Setting">
<img src=https://shihchinw.github.io/images/maya/maya_display_gamma.png alt="Gamma Correction in Render View"></p><p>The last thing is that MtoA doesn&rsquo;t support <code>color space</code> configuration in file node currently (v1.2.4.3).
<img src=https://shihchinw.github.io/images/arnold/mtoa_file_color_space.png alt="Color space control in file node"></p><p>We could use extra gamma nodes to convert images to linear space, but the recommended approach is to use following command to convert the color texture file to avoid run-time shading overhead:
<samp>maketx &ndash;colorconvert sRGB linear path-to-image</samp></p><h1 id=look-dev>Look-Dev</h1><ol><li>Ensure <strong>&ldquo;Energy Conservation&rdquo;</strong> (i.e. outgoing energy ≤ incoming energy)</li></ol><ul><li>In physically-based setup, the energy of each ray should not get higher after each bounce, or you might get <a href=https://support.solidangle.com/display/ARP/Fireflies>fireflies</a> in your render images. There are <a href=https://support.solidangle.com/display/AFMUG/Standard#Standard-EnergyConservation>two approaches</a> to ensure this:<ol><li>Make sure the sum of relevant parameters is less than one, or</li><li>Turn on Fresnel for diffuse/specular/reflection/refraction</li></ol></li></ul><ol start=2><li>Avoid unnecessary transparent setting.</li></ol><ul><li>It might be helpful to use <a href=https://support.solidangle.com/display/AFMUG/Override+Sets>set-override</a> to switch the <code>aiOpaque</code> attribute for LOD. (We can switch aiOpaque on for the objects which are far from camera.)</li></ul><ol start=3><li>Use <a href=https://support.solidangle.com/display/AFMUG/Ray+Switch><code>aiRaySwith</code></a> to simplify the shading of indirect bounce (the detail is beyond this post).</li><li>If possible, avoid blending multiple material shaders (e.g. aiStandard, aiSkin)</li></ol><ul><li>Try to compose the control parameters into textures and connect those textures to a single shader.</li><li>Since each material shader would spawn rays to compute a resultant color, thus the more material shaders we use in a single shading network, the more rays are fired for a resultant color computation, or</li><li>Try using <a href=https://bitbucket.org/anderslanglands/alshaders/wiki/alLayer>alLayer</a> in alShaders [<a href=#ref.1>1</a>] for complicated mixture materials.</li></ul><ol start=5><li>In general case, try to use <a href=https://support.solidangle.com/display/AFMUG/Standard#Standard-SpecularityvsReflection>specular</a> rather than reflection in aiStandard.</li></ol><ul><li>Unlike specular, reflection would not sample the lights!</li></ul><ol start=6><li>Prefer <a href=https://support.solidangle.com/display/AFMUG/Mesh+Light#MeshLight-MeshLightvsEmission>mesh light</a> over emission in aiStandard.</li></ol><h1 id=lighting>Lighting</h1><ol><li>Before up-sampling to remove the noise, <span class=orange>examine each AOV for the source of noise first!!</span>
<img src=https://shihchinw.github.io/images/arnold/mtoa_aov_setting.jpg alt="mtoa AOV browser"> <img src=https://shihchinw.github.io/images/arnold/mtoa_aovs.jpg alt="mtoa AOVs"></li><li>Keep the number of <strong>rays/pixel</strong> in a reasonable range<ul><li>As mentioned in [<a href=#ref.2>2</a>], 2000~3000 rays/pixel is not uncommon in <em>&ldquo;The Amazing Spider Man 2&rdquo;</em>.</li><li>The rule-of-thumb is to strike a balance between AA and other ray type samples:<ul><li><span class=blue>AA ↑, Diffuse/Glossy/Refraction/SSS/Light ↓</span> or</li><li><span class=blue>AA ↓, Diffuse/Glossy/Refraction/SSS/Light ↑</span></li></ul></li><li><span class=blue>When motion blur is on, reset all sample number to 1 and increase AA sample from 5 progressively.</span><ul><li>Remember, the actual sample count is the <strong>square of the value</strong> of the sample attribute.</li></ul></li></ul></li><li>Check CPU & ray-count AOVs to examine the performance bottleneck.
I personally use <a href=http://docs.autodesk.com/MENTALRAY/2015/CHS/mental-ray-help/files/manual/imf_disp.html>imf_disp</a> (provided by mental ray :D) to view EXR files. When we examine the image whose pixel values are higher than 1, we have to decrease the exposure value for better visual display. In addition, the status bar at bottom would show the pixel value pointed by the cursor.
<img src=https://shihchinw.github.io/images/arnold/mtoa_ray_count.jpg width=70%></li><li>For the objects which need relatively high sample count compared to the rest of the scene, separate them into another render layer with extra high samples. (e.g. complex refractive geometry or rough specular object)</li><li>Avoid unnecessary ray depth.</li></ol><ul><li>Do we really need a second/third bounce diffuse/specular in outdoor scene? If there is no or tiny visual differences, it would be better to keep the ray depth as shallow as possible.</li></ul><ol start=6><li>Use a dummy geometry (whose primary visibility is off) as bounce card.</li><li>Prune unnecessary lights which contribute low energy to the scene.</li><li>Hide unnecessary objects which has no impact to the render image [<a href=#ref.4>4</a>].</li></ol><ul><li>It might be helpful to use a frustum to hide objects far away (i.e. visibility culling)</li></ul><ol start=9><li>Use <code>min pixel width</code> with care for hair/fur rendering, it would change opaque mode subtly. [[more details]({% post_url 2015-09-24-using-min-pixel-width-with-care-in-arnold %})]</li></ol><h1 id=feedback>Feedback</h1><blockquote id=FDBK1 class=feedback><a href=http://www.sosoyan.com/>Sosoyan</a>
<time>November 28, 2015</time><p>Not sure about to Turn off “Tiled”, because in this case raw buckets are being stored in the memory until the render finished. First you are getting waste of memory especially if you have many Aovs you can get around 1.5GB more than tiled, second while tiled is on you can view your unfinished render in progress for example with RV.</p><p>In terms of scanline thing, I assume this post is to old, because Nuke 9 is fine with tiled Exrs now.</p></blockquote><h1 id=references>References</h1><ol><li><cite id=ref.1><a href=http://anderslanglands.com/alshaders/index.html>alShaders</a></cite>. Wonderful 3rd party physically-based shaders developed by Anders Langlands.</li><li><cite id=ref.2><a href=http://dl.acm.org/authorize?6945594>Raytracers and workflow: a production perspective</a></cite>, SIGGRAPH'14 Course Note</li></ol><ul><li>There are many in-depth optimization tips for SPI Arnold (but some concepts are the same in Arnold). Highly recommended! A must-read document for Arnold users.</li></ul><ol start=3><li><a href=http://blog.animationmentor.com/vfx-tiger-and-tips-using-the-arnold-renderer/>VFX Tiger and Tips Using The Arnold Renderer</a> by Animation Mentor</li><li>Repasky, Zachary, et al. <cite id=ref.4><a href=http://graphics.pixar.com/library/VisibilityCulling/>Large Scale Geometric Visibility Culling on Brave</a></cite>. PIXAR Technical Report. 2013.</li></ol><hr><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//shihchinw.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div></article><hr><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a href=mailto:shihchin.weng@gmail.com><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i>
<i class="fa fa-envelope-o fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://twitter.com/shihchinw><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i>
<i class="fa fa-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://github.com/shihchinw><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i>
<i class="fa fa-github fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright © Shih-Chin</p></div></div></div></footer><script src=https://shihchinw.github.io/js/jquery.min.js></script><script src=https://shihchinw.github.io/js/bootstrap.min.js></script><script src=https://shihchinw.github.io/js/clean-blog.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-L4ZM8YZ5G6"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-L4ZM8YZ5G6",{anonymize_ip:!1})}</script><script src=https://shihchinw.github.io/js/lightbox.js></script><script src=https://shihchinw.github.io/js/jquery.event.move.js></script><script src=https://shihchinw.github.io/js/jquery.twentytwenty.js></script><script>$(window).load(function(){$(".twentytwenty-container[data-orientation!='vertical']").twentytwenty({default_offset_pct:.7}),$(".twentytwenty-container[data-orientation='vertical']").twentytwenty({default_offset_pct:.3,orientation:"vertical"})}),$(function(){return $("h1, h2, h3, h4, h5, h6").each(function(e,t){var n=$(t),s=n.attr("id"),o='<i class="fa fa-link"></i>';if(s)return n.append($("<a />").addClass("header-link").attr("href","#"+s).html(o))})})</script></body></html>